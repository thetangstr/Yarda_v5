â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          FRONTEND GENERATION FLOW - COMPONENT ARCHITECTURE MAP             â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAGE: generate.tsx (446 lines)                                              â”‚
â”‚ Role: Single-page coordinator, polling lifecycle manager                   â”‚
â”‚ State: generationStore (Zustand)                                           â”‚
â”‚ Phases: form â†’ progress â†’ results                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”œâ”€â”€ Navbar
        â”‚   â”œâ”€â”€ Logo "Yarda"
        â”‚   â”œâ”€â”€ TokenBalance (variant="compact", autoRefresh=true)
        â”‚   â””â”€â”€ TrialCounter (variant="compact")
        â”‚
        â”œâ”€â”€ PHASE 1: FORM (Always visible, disabled during generation)
        â”‚   â””â”€â”€ GenerationFormEnhanced
        â”‚       â”œâ”€â”€ AddressInput
        â”‚       â”œâ”€â”€ AreaSelectorEnhanced (front_yard, back_yard, walkway)
        â”‚       â”œâ”€â”€ StyleSelectorEnhanced (minimalist, mediterranean, california_native)
        â”‚       â”œâ”€â”€ PreservationStrengthSlider (0.0-1.0)
        â”‚       â””â”€â”€ Submit Button â†’ onGenerationStart(generationId)
        â”‚
        â”œâ”€â”€ PHASE 2: PROGRESS (AnimatePresence when isGenerating=true)
        â”‚   â”œâ”€â”€ Network Error Banner (if networkError !== null)
        â”‚   â”œâ”€â”€ Timeout Error Banner (if timedOut=true)
        â”‚   â””â”€â”€ GenerationProgressInline (lines 251)
        â”‚       â””â”€â”€ For each area in areaResults:
        â”‚           â”œâ”€â”€ Area Header
        â”‚           â”‚   â”œâ”€â”€ Emoji icon
        â”‚           â”‚   â”œâ”€â”€ Area name ("Front Yard", "Back Yard", "Walkway")
        â”‚           â”‚   â”œâ”€â”€ Status text (animated color)
        â”‚           â”‚   â””â”€â”€ Status icon (spinner â†’ checkmark â†’ X)
        â”‚           â”œâ”€â”€ Progress Bar (0-100% animated)
        â”‚           â”œâ”€â”€ Thumbnail Preview (when imageUrl available)
        â”‚           â”‚   â”œâ”€â”€ Image display
        â”‚           â”‚   â”œâ”€â”€ Processing overlay (if processing)
        â”‚           â”‚   â””â”€â”€ Status badge ("âœ“ Design Complete" or "ğŸ¨ Processing...")
        â”‚           â””â”€â”€ Error message (if area.error)
        â”‚       â””â”€â”€ Loading Indicator (pulsing dots animation)
        â”‚
        â”œâ”€â”€ PHASE 3: RESULTS (AnimatePresence when phase='results')
        â”‚   â””â”€â”€ GenerationResultsInline (lines 294)
        â”‚       â”œâ”€â”€ Success Banner
        â”‚       â”‚   â”œâ”€â”€ Big emoji title ("ğŸ‰ All Designs Created!")
        â”‚       â”‚   â”œâ”€â”€ Property address
        â”‚       â”‚   â””â”€â”€ Stats: Total Areas | Successful | Failed
        â”‚       â”‚
        â”‚       â””â”€â”€ Results Grid (responsive: 1 col â†’ 3 cols)
        â”‚           â””â”€â”€ For each area in areaResults:
        â”‚               â”œâ”€â”€ Card Header
        â”‚               â”‚   â”œâ”€â”€ Emoji + Area name
        â”‚               â”‚   â”œâ”€â”€ Success/Failed badge
        â”‚               â”‚   â””â”€â”€ Status icon
        â”‚               â”œâ”€â”€ Result Image
        â”‚               â”‚   â””â”€â”€ On click: setSelectedImage() â†’ Modal
        â”‚               â”œâ”€â”€ Download Button â†’ Trigger browser download
        â”‚               â””â”€â”€ View Full Size Button â†’ setSelectedImage()
        â”‚
        â”œâ”€â”€ Image Modal (AnimatePresence when selectedImage !== null)
        â”‚   â”œâ”€â”€ Dark overlay (click to close)
        â”‚   â”œâ”€â”€ Full-size image centered
        â”‚   â””â”€â”€ Close button (top-right)
        â”‚
        â”œâ”€â”€ Action Button
        â”‚   â””â”€â”€ "Create New Design" â†’ handleStartNew()
        â”‚       â””â”€â”€ Resets: phase, results, polling, form
        â”‚
        â””â”€â”€ Debug Panel (bottom, admin only)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          DATA FLOW DIAGRAM                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USER SUBMITS FORM
    â†“
generationsAPI.create(request) â”€â”€â†’ POST /v1/generations
    â†“
GenerationResponse {
    id: "uuid",
    status: "pending",
    areas: [{ area: "front_yard", status: "pending", ... }],
    ...
}
    â†“
onGenerationStart(id) callback
    â†“
startPolling(id) + saveGenerationToLocalStorage(id, areas, address)
    â†“
setGenerationPhase('progress')
    â†“
POLLING LOOP (every 2s)
    â”‚
    â””â”€â”€â†’ pollGenerationStatus(id)
            â†“
            generationsAPI.getStatus(id) â”€â”€â†’ GET /v1/generations/{id}
            â†“
            GenerationStatusResponse {
                areas: [{
                    area: "front_yard",
                    status: "processing" or "completed" or "failed",
                    image_url: "https://...", â† When completed
                    progress: 50,
                    ...
                }],
                source_images?: [{ â† Available during generation
                    image_type: "street_view",
                    image_url: "https://..."
                }],
                ...
            }
            â†“
            onProgress callback
                â†“
                updatePollingProgress(areaId, status, imageUrl, progress)
                    â†“
                    Update state:
                    - areaResults[] with new status/imageUrl/progress
                    - overallStatus
                â†“
                Component re-renders:
                - Progress bars animate to new percentage
                - Status icons change (spinner/checkmark/X)
                - Thumbnails appear when imageUrl loaded
            â†“
            Check: allDone = areas.every(a => a.status === 'completed' || 'failed')
            â†“
            If allDone OR timeout:
                onComplete callback
                    â†“
                    setGenerationPhase('results')
                    clearGenerationFromLocalStorage()
                    stopPolling()
                    â†“
                    Components animate:
                    - Progress cards exit
                    - Results grid enters


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                        STATE MANAGEMENT (Zustand)                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

useGenerationStore
â”œâ”€â”€ FORM STATE (Persisted to localStorage)
â”‚   â”œâ”€â”€ address: string
â”‚   â”œâ”€â”€ placeId: string
â”‚   â”œâ”€â”€ selectedAreas: string[]           ["front_yard", "back_yard"]
â”‚   â”œâ”€â”€ areaPrompts: Record<string, string>  { front_yard: "flowers, patio" }
â”‚   â””â”€â”€ selectedStyles: string[]
â”‚
â”œâ”€â”€ GENERATION STATE (Transient)
â”‚   â”œâ”€â”€ currentGeneration: Generation | null
â”‚   â”œâ”€â”€ generationHistory: Generation[]
â”‚   â””â”€â”€ isGenerating: boolean
â”‚
â””â”€â”€ POLLING STATE (Transient, reset on reload)
    â”œâ”€â”€ pollingRequestId: string | null
    â”œâ”€â”€ pollingProgress: Record<string, {
    â”‚   status: "pending" | "processing" | "completed" | "failed",
    â”‚   imageUrl?: string,
    â”‚   progress?: number
    â”‚ }>
    â”œâ”€â”€ pollingError: string | null
    â””â”€â”€ pollingTimedOut: boolean


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      ANIMATION TIMING ORCHESTRATION                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FORM PHASE (Initial)
â”œâ”€â”€ Form container: fade-in + slide-down (0.3s)
â””â”€â”€ (visible throughout, but disabled when generating)

PROGRESS PHASE (On Generation Start)
â”œâ”€â”€ Progress container: fade-in + slide-down (0.3s)
â”œâ”€â”€ Area cards (staggered):
â”‚   â””â”€â”€ Card N: fade + slide-left (delay: N * 0.1s, duration: 0.3s)
â”œâ”€â”€ Within each card:
â”‚   â”œâ”€â”€ Progress bar: width animation to current % (0.3s)
â”‚   â”œâ”€â”€ Spinner icon: rotate 360Â° continuously (1s loop)
â”‚   â”œâ”€â”€ Thumbnail: scale 0.95â†’1 + fade (0.3s when imageUrl loads)
â”‚   â””â”€â”€ Status badge: fade-in (0.3s)
â””â”€â”€ Loading dots: pulsing scale animation (1.5s with staggered delays)

RESULTS PHASE (On Completion)
â”œâ”€â”€ Progress section: fade-out + slide-up (0.3s)
â”œâ”€â”€ Results container: fade-in + slide-down (0.3s)
â”œâ”€â”€ Result cards (staggered):
â”‚   â””â”€â”€ Card N: scale 0.95â†’1 + fade (delay: N * 0.1s, duration: 0.3s)
â”œâ”€â”€ "Create New Design" button: fade-in (delay: 0.5s)
â””â”€â”€ Image modal (when viewing):
    â”œâ”€â”€ Overlay: fade-in (0.3s)
    â””â”€â”€ Image: scale 0.9â†’1 (0.3s)

Smooth scrolling between sections:
- Form-to-Progress: progressRef.scrollIntoView({ behavior: 'smooth' })
- Progress-to-Results: resultsRef.scrollIntoView({ behavior: 'smooth' })


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      KEY FILES & RESPONSIBILITIES                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PAGES
â”œâ”€â”€ src/pages/generate.tsx (446 lines)
â”‚   â””â”€â”€ Single-page coordinator, polling lifecycle, phase management

COMPONENTS
â”œâ”€â”€ src/components/generation/GenerationFormEnhanced.tsx
â”‚   â””â”€â”€ Form inputs, validation, API call, payment check
â”œâ”€â”€ src/components/generation/GenerationProgressInline.tsx (251 lines)
â”‚   â””â”€â”€ Per-area progress cards, status icons, thumbnails
â”œâ”€â”€ src/components/generation/GenerationResultsInline.tsx (294 lines)
â”‚   â””â”€â”€ Results grid, download, modal viewer
â”œâ”€â”€ src/components/generation/shared/constants.ts
â”‚   â””â”€â”€ Animation timing, color mappings
â””â”€â”€ src/components/generation/shared/utils.ts
    â””â”€â”€ Emoji & display name mappings

STATE & STORAGE
â”œâ”€â”€ src/store/generationStore.ts (318 lines)
â”‚   â””â”€â”€ Zustand with selective localStorage persistence
â””â”€â”€ src/lib/localStorage-keys.ts
    â””â”€â”€ Recovery helpers, storage keys

UTILITIES & TYPES
â”œâ”€â”€ src/lib/api.ts (lines 490-577)
â”‚   â””â”€â”€ pollGenerationStatus() function (2s interval, 5min timeout)
â”œâ”€â”€ src/lib/suggested-prompts.ts
â”‚   â””â”€â”€ 30+ emoji mappings, 5 prompts per area
â””â”€â”€ src/types/generation.ts
    â””â”€â”€ TS interfaces for all API responses


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    POLLING MECHANISM DETAILS                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

pollGenerationStatus(generationId, callbacks)
â”‚
â”œâ”€â”€ 1. Initial check (immediate, don't wait)
â”‚   â””â”€â”€ generationsAPI.getStatus(id)
â”‚
â”œâ”€â”€ 2. Setup polling loop (every 2 seconds)
â”‚   â””â”€â”€ setInterval(checkStatus, 2000)
â”‚
â”œâ”€â”€ 3. Setup timeout (5 minutes)
â”‚   â””â”€â”€ setTimeout(cleanup, 300000)
â”‚
â”œâ”€â”€ 4. On each poll result:
â”‚   â”œâ”€â”€ Call onProgress(response)
â”‚   â”œâ”€â”€ Check: allDone = areas.every(a => a.status === 'completed' || 'failed')
â”‚   â”œâ”€â”€ If allDone:
â”‚   â”‚   â””â”€â”€ cleanup() + call onComplete(response)
â”‚   â””â”€â”€ If error:
â”‚       â””â”€â”€ call onError(error)
â”‚
â”œâ”€â”€ 5. On timeout:
â”‚   â””â”€â”€ cleanup() + call onTimeout()
â”‚
â””â”€â”€ 6. Return cleanup function for unmount
    â””â”€â”€ Clears interval, timeout, sets cancelled=true


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                         WHAT'S AVAILABLE NOW                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Single-page experience (no page navigations)
âœ… Real-time polling every 2 seconds
âœ… Per-area progress cards with animations
âœ… Progress bars (0-100% fill)
âœ… Status icons (spinner, checkmark, X)
âœ… Thumbnail preview (when imageUrl available)
âœ… Error handling & network recovery
âœ… 5-minute timeout with user messaging
âœ… Framer Motion animations (24+ animated elements)
âœ… localStorage recovery on page refresh
âœ… Results grid (responsive 1â†’3 columns)
âœ… Download buttons per image
âœ… Full-size image modal viewer
âœ… Restart button ("Create New Design")
âœ… Zustand state with persistence
âœ… Suggested prompts system (30+ emoji mappings)


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     WHAT'S MISSING / ENHANCEMENT GAPS                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ SOURCE IMAGE CAROUSEL
   - API returns source_images (Street View + Satellite)
   - Currently: Not displayed during progress
   - Gap: No user context of what's being processed
   - Implementation: GenerationSourceImagesCarousel.tsx

âŒ PROCESSING STAGE VISUALIZATION
   - API returns current_stage enum (6 stages)
   - Currently: Binary "processing" vs "done"
   - Gap: User doesn't know which sub-task is running
   - Implementation: Step indicator "Analyzing property (2/6)"

âŒ BEFORE/AFTER COMPARISON
   - Results show only final design
   - Gap: No side-by-side transformation view
   - Implementation: Side-by-side slider

âŒ ADVANCED DOWNLOAD OPTIONS
   - Only direct browser download
   - Gap: No print optimization, batch zip, email
   - Implementation: Download menu with options

